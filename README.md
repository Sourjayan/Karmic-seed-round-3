# Karmic-seed-round-3

## pricing strategy 


| SKU | Product Name | Type | Current Price | Total Unit Cost | Min Price (Margin Floor) | Competitor Avg | **Rec. Price** | **Action** | Rationale |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **MN-01** | Rectangle Tray 14x10 | Core | $38.90 | $32.30 | $40.38 | $36.90 | **$40.38** | **INCREASE** | Currently below 20% margin target. Raising to floor. |
| **MN-02** | Rectangle Tray 12x10 | Core | $33.90 | $26.60 | $33.25 | $32.50 | **$32.50** | **DECREASE** | Price is above market average. Reduce to match competitor to regain volume. |
| **MN-03** | Oval Tray 15x10 | Core | $34.90 | $30.03 | $37.54 | $35.20 | **$39.00** | **INCREASE** | High demand (ROAS > 20) & Margin Gap. Increase to capture value. |
| **MN-04** | Oval Tray 13x9 | Core | $29.90 | $25.94 | $32.43 | $28.40 | **$32.50** | **INCREASE** | Severely underpriced relative to cost. Move to margin target. |
| **MN-05** | Christmas Tray 17x12 | Seasonal | $21.90 | $25.77 | $34.36 | $23.90 | **$34.36** | **INCREASE** | **CRITICAL LOSS.** Selling below cost. Must raise to hit 25% seasonal margin. |
| **MN-06** | Star Tray 14 Inch | Seasonal | $14.95 | $14.37 | $19.16 | $15.80 | **$19.16** | **INCREASE** | Selling at cost. Raise to meet 25% margin target. |
| **MN-07** | 15 Round Plate | Core | $34.90 | $29.87 | $37.34 | $33.50 | **$37.34** | **INCREASE** | Below margin target. Raise to floor. |
| **MN-08** | 10 Heart Plates | Seasonal | $29.90 | $26.11 | $34.81 | $31.20 | **$34.81** | **INCREASE** | Selling below cost. Raise to meet 25% margin target. |
| **MN-09** | 6 Heart Plates | Seasonal | $14.90 | $24.92 | $33.23 | $15.60 | **$33.23** | **INCREASE** | **CRITICAL LOSS.** Price is less than half of total cost. |
| **MN-10** | 9x6 Rectangle | Core | $19.90 | $21.40 | $26.75 | $19.90 | **$26.75** | **INCREASE** | Selling below cost. Raise to margin floor. |
| **MN-11** | Oval Tray 13x9 (10pk) | Core | $16.90 | $20.26 | $25.33 | $17.80 | **$25.33** | **INCREASE** | Selling below cost. Raise to margin floor. |
| **MN-12** | 13 Round DEEP Plate | Core | $19.90 | $21.87 | $27.34 | $21.40 | **$27.34** | **INCREASE** | Selling below cost. Raise to margin floor. |
| **MN-13** | 14 Round DEEP Plate | Core | $22.90 | $23.80 | $29.75 | $24.20 | **$29.75** | **INCREASE** | Selling below cost. Raise to margin floor. |
| **MN-14** | 12 Round Plate | Core | $26.90 | $24.93 | $31.16 | $27.80 | **$31.16** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-15** | Rectangle Tray 14x10 (10pk)| Core | $21.90 | $19.24 | $24.05 | $22.40 | **$24.05** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-16** | Oval Tray 15x10 (10pk) | Core | $19.90 | $21.40 | $26.75 | $20.10 | **$26.75** | **INCREASE** | Selling below cost. Raise to margin floor. |
| **MN-17** | Square Combo 10&7 | Core | $29.90 | $27.98 | $34.98 | $31.50 | **$34.98** | **INCREASE** | High demand (ROAS 16) + Margin Gap. Raise to floor. |
| **MN-18** | Round Combo 10&7 | Core | $26.90 | $27.73 | $34.66 | $28.80 | **$34.66** | **INCREASE** | Selling below cost. Raise to margin floor. |
| **MN-19** | Oval Tray 22x12 | Core | $36.90 | $32.94 | $41.18 | $38.90 | **$41.18** | **INCREASE** | Significant margin gap. Raise to floor. |
| **MN-20** | 3.5 Round Bowl | Core | $11.90 | $21.02 | $26.28 | $12.50 | **$26.28** | **INCREASE** | **CRITICAL LOSS.** Selling at less than half of total cost. |
| **MN-21** | 11x7 Rectangle | Core | $21.90 | $19.40 | $24.25 | $23.10 | **$24.25** | **INCREASE** | Low stock (Critical) + Margin Gap. Raise to floor. |
| **MN-22** | 13 Round Plate (10pk) | Core | $20.90 | $19.08 | $23.85 | $21.90 | **$23.85** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-23** | 2.5 Round Bowl | Core | $9.95 | $20.40 | $25.50 | $10.50 | **$25.50** | **INCREASE** | **CRITICAL LOSS.** Selling at less than half of total cost. |
| **MN-24** | Rectangle Tray 12x10 (10pk)| Core | $19.90 | $19.62 | $24.53 | $20.80 | **$24.53** | **INCREASE** | Selling at cost. Raise to margin floor. |
| **MN-25** | 10 Square (50pk) | Core | $34.90 | $31.21 | $39.01 | $35.50 | **$42.90** | **INCREASE** | **CRITICAL STOCK.** Stock will run out in <10 days. Increase to preserve inventory. |
| **MN-26** | 8 Square (50pk) | Core | $29.90 | $26.85 | $33.56 | $30.40 | **$33.56** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-27** | 7 Square (50pk) | Core | $28.90 | $24.18 | $30.23 | $29.90 | **$30.23** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-28** | 6 Square (50pk) | Core | $24.90 | $22.47 | $28.09 | $26.20 | **$28.09** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-29** | 4 Square (50pk) | Core | $21.90 | $19.71 | $24.64 | $22.80 | **$24.64** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-30** | 10 Round (50pk) | Core | $34.90 | $35.23 | $44.04 | $36.40 | **$44.04** | **INCREASE** | Selling below cost. Raise to margin floor. |
| **MN-31** | 8 Round (50pk) | Core | $28.90 | $26.55 | $33.19 | $29.80 | **$33.19** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-32** | 7 Round (50pk) | Core | $26.90 | $25.91 | $32.39 | $27.50 | **$32.39** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-33** | 6 Round (50pk) | Core | $25.90 | $25.16 | $31.45 | NA | **$25.00** | **DECREASE** | Low Efficiency (ROAS < 2.5). Drop price to stimulate volume. |
| **MN-34** | 9 Square (50pk) | Core | $32.90 | $28.44 | $35.55 | $33.80 | **$35.55** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-35** | 9 Round (50pk) | Core | $31.90 | $28.49 | $35.61 | $32.90 | **$35.61** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-36** | 17x12 Oval Tray (10pk) | Core | $29.90 | $25.05 | $31.31 | $30.10 | **$31.31** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-37** | 11 Square (25pk) | Core | $28.90 | $25.92 | $32.40 | $29.40 | **$32.40** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-38** | 3.5 Round Bowl (100pk) | Core | $29.90 | $26.54 | $33.18 | $31.20 | **$33.18** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-39** | 2.5 Round Bowl (100pk) | Core | $24.90 | $22.93 | $28.66 | $25.80 | **$28.66** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-40** | 5 Square (50pk) | Core | $23.90 | $19.67 | $24.59 | $24.90 | **$24.90** | **INCREASE** | Match Competitor Average. |
| **MN-41** | 6 Square (200pk) | Core | $78.90 | $63.42 | $79.28 | $82.50 | **$82.90** | **INCREASE** | High Efficiency (ROAS > 10). Capture margin & match market. |
| **MN-42** | 4 Square (200pk) | Core | $73.90 | $50.79 | $63.49 | $76.80 | **$76.80** | **INCREASE** | High Efficiency (ROAS > 10). Match Competitor Average. |
| **MN-43** | 3.5 Square Bowl (25pk) | Core | $13.90 | $20.81 | $26.01 | $14.80 | **$26.01** | **INCREASE** | **CRITICAL LOSS.** Selling at massive loss. Raise to floor. |
| **MN-44** | 2.5 Square Bowl (25pk) | Core | $11.90 | $19.66 | $24.58 | $9.99* | **$24.58** | **INCREASE** | **CRITICAL LOSS.** Selling at massive loss. Competitor data error suspected. |
| **MN-45** | 3.5 Square Bowl (100pk) | Core | $29.90 | $25.68 | $32.10 | $31.40 | **$32.10** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-46** | 2.5 Square Bowl (100pk) | Core | $26.90 | $21.99 | $27.49 | $28.90 | **$27.49** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-47** | 5 Square (200pk) | Core | $76.90 | $55.34 | $69.18 | $80.40 | **$80.40** | **INCREASE** | High Efficiency (ROAS > 10). Match Competitor Average. |
| **MN-48** | 7 Square (200pk) | Core | $89.90 | $68.98 | $86.23 | $88.20 | **$88.20** | **DECREASE** | Slightly above market average. Drop to align. |
| **MN-49** | 11x7 Rectangle (50pk) | Core | $32.90 | $30.56 | $38.20 | $33.10 | **$38.20** | **INCREASE** | Margin gap exists. Raise to floor. |
| **MN-50** | 9x6 Rectangle (50pk) | Core | $29.90 | $27.60 | $34.50 | $30.20 | **$34.50** | **INCREASE** | Margin gap exists. Raise to floor. |

## python scripts
```python
import pandas as pd
import numpy as np

# ... (Assuming you loaded data_dict using the script in Part 1) ...

def generate_final_pricing(data_dict):
    
    # 1. Extract Dataframes
    ads = data_dict.get('Ads_Performance')
    inventory = data_dict.get('Inventory_Health')
    pricing = data_dict.get('Pricing_Data') # Contains Base Cost / Current Price
    competitor = data_dict.get('Competitor_Data')

    if not all([ads, inventory, pricing, competitor]):
        print("Missing critical sheets. Cannot run full analysis.")
        return

    # 2. Pre-processing
    
    # Aggregate Ads Data to get ROAS and Velocity
    ads_summary = ads.groupby('SKU').agg({
        'sales30d': 'sum',
        'unitsSoldClicks30d': 'sum',
        'roasClicks14d': 'mean'
    }).reset_index()

    # Merge Current Price from Pricing Data (Assuming 'SKU' and 'price' columns exist)
    # If pricing sheet is just a list of SKUs and prices:
    merged = pd.merge(ads_summary, pricing[['SKU', 'price']], on='SKU', how='left')
    
    # Merge Inventory Health (Assuming 'SKU' and 'days_of_supply' columns)
    merged = pd.merge(merged, inventory[['SKU', 'days_of_supply']], on='SKU', how='left')
    
    # Merge Competitor Data (Assuming 'SKU' and 'avg_competitor_price' columns)
    merged = pd.merge(merged, competitor[['SKU', 'min_competitor_price', 'avg_competitor_price']], on='SKU', how='left')

    # Fill NaNs for Inventory/Competitor with defaults if data is missing
    merged['days_of_supply'].fillna(45, inplace=True) # Assume healthy if missing
    merged['avg_competitor_price'].fillna(merged['price'], inplace=True) # Assume no competitors if missing

    # 3. Apply Logic
    recommendations = []

    for _, row in merged.iterrows():
        sku = row['SKU']
        current_price = row['price']
        roas = row['roasClicks14d']
        days_supply = row['days_of_supply']
        comp_avg = row['avg_competitor_price']
        
        rec_price = current_price
        action = "HOLD"
        rationale = "Price optimized for market and efficiency."

        # --- LOGIC HIERARCHY ---

        # RULE 1: Inventory Urgency (Highest Priority)
        if days_supply < 14:
            action = "INCREASE"
            rec_price = current_price * 1.15
            rationale = "CRITICAL STOCK (<14 days). Raising price to slow sales and maximize margin."

        elif days_supply > 90:
            action = "DECREASE"
            rec_price = current_price * 0.90
            rationale = "OVERSTOCKED (>90 days). Discounting to clear inventory."

        # RULE 2: Competitor Gap (Only if Inventory is okay)
        elif 14 <= days_supply <= 90:
            
            # We are significantly more expensive than market
            if current_price > (comp_avg * 1.1): 
                action = "DECREASE"
                rec_price = comp_avg * 1.02 # Price slightly above average
                rationale = "Uncompetitive pricing. Dropping to market average."

            # We are significantly cheaper than market
            elif current_price < (comp_avg * 0.9):
                action = "INCREASE"
                rec_price = comp_avg * 0.98 # Price slightly below average
                rationale = "Underpriced vs Market. Increasing to capture margin."

            # RULE 3: Ad Efficiency (Tie-breaker)
            else:
                if roas < 2.0:
                    action = "DECREASE"
                    rec_price = current_price * 0.95
                    rationale = "Low conversion (ROAS < 2). Small price cut to boost traffic."
                elif roas > 5.0:
                    action = "INCREASE"
                    rec_price = current_price * 1.05
                    rationale = "High demand (ROAS > 5). Testing price elasticity."

        recommendations.append({
            'SKU': sku,
            'Current_Price': round(current_price, 2),
            'Inventory_Days': days_supply,
            'Comp_Avg_Price': round(comp_avg, 2),
            'ROAS': round(roas, 2),
            'Action': action,
            'Recommended_Price': round(rec_price, 2),
            'Rationale': rationale
        })

    return pd.DataFrame(recommendations)

# Usage example:
# final_df = generate_final_pricing(data_dict)
# print(final_df)
```

```python
import pandas as pd
import numpy as np
import warnings

# Suppress warnings for cleaner output
warnings.filterwarnings('ignore')

def load_and_clean_data():
    """
    Loads all 6 datasets provided in the assignment.
    """
    print("--- Loading Data ---")
    
    # 1. Pricing Data (Base Costs and Prices)
    pricing = pd.read_csv('Pricing_Data.csv')
    # Clean currency symbols if present (e.g., $15.11 -> 15.11)
    for col in ['FBA Fee', 'Storage Fee', 'Handling_Cost', 'Cost', 'Current_Price']:
        pricing[col] = pricing[col].replace('[\$,]', '', regex=True).astype(float)
    
    # 2. Inventory Health (Supply levels)
    inventory = pd.read_csv('Inventory_Health.csv')
    # Ensure numeric
    inventory['days-of-supply'] = pd.to_numeric(inventory['days-of-supply'], errors='coerce').fillna(0)
    
    # 3. Competitor Data (Market benchmarks)
    competitor = pd.read_csv('Competitor_Data.csv')
    for col in ['Avg_Competitor_Price', 'Lowest_Competitor_Price', 'Highest_Competitor_Price']:
        competitor[col] = competitor[col].replace('[\$,]', '', regex=True).astype(float)
    
    # 4. Ads Performance (Efficiency)
    ads = pd.read_csv('Ads_Performance.csv')
    # Clean spend and sales columns
    for col in ['spend', 'sales7d', 'sales14d', 'sales30d']:
        ads[col] = ads[col].replace('[\$,]', '', regex=True).astype(float)
    # Handle ROAS specifically (might be text or float)
    ads['roasClicks7d'] = pd.to_numeric(ads['roasClicks7d'], errors='coerce').fillna(0)
    
    # 5. Historical Sales (Velocity)
    sales = pd.read_csv('Historical_Sales.csv')
    sales['Units Ordered'] = pd.to_numeric(sales['Units Ordered'], errors='coerce').fillna(0)
    
    # 6. Returns Data (Quality check)
    returns = pd.read_csv('Returns_Data.csv')
    
    print("Data loaded successfully.\n")
    return pricing, inventory, competitor, ads, sales, returns

def calculate_economic_floor(pricing_df):
    """
    Calculates the minimum price required to meet 'Minimum_Acceptable_Margin_%'.
    Formula: Price = Total Cost / (1 - Margin_%)
    Total Cost = COGS + FBA Fee + Storage Fee + Handling Cost
    """
    pricing_df['Total_Unit_Cost'] = (
        pricing_df['Cost'] + 
        pricing_df['FBA Fee'] + 
        pricing_df['Storage Fee'] + 
        pricing_df['Handling_Cost']
    )
    
    # Convert margin percentage to decimal (e.g., 20% -> 0.20)
    pricing_df['min_margin_decimal'] = pricing_df['Minimum_Acceptable_Margin_%'].str.replace('%', '').astype(float) / 100
    
    # Calculate Floor Price
    # Avoid division by zero if margin is 100% (unlikely) or missing
    pricing_df['Min_Acceptable_Price'] = pricing_df.apply(
        lambda row: row['Total_Unit_Cost'] / (1 - row['min_margin_decimal']) if row['min_margin_decimal'] < 1 else row['Total_Unit_Cost'] * 1.5,
        axis=1
    )
    
    return pricing_df

def generate_recommendations(pricing, inventory, competitor, ads, sales, returns):
    """
    Merges datasets and applies the 4-step logic framework.
    """
    
    # --- AGGREGATION ---
    
    # Aggregate Ads by SKU to get average ROAS
    ads_agg = ads.groupby('SKU').agg({
        'roasClicks7d': 'mean',
        'sales7d': 'sum',
        'spend': 'sum'
    }).reset_index()
    
    # Aggregate Sales by SKU to get total units sold
    sales_agg = sales.groupby('SKU').agg({
        'Units Ordered': 'sum'
    }).reset_index()
    
    # Aggregate Returns by SKU
    returns_agg = returns.groupby('SKU').agg({
        'Return Quantity \n(Last 90 days)': 'sum'
    }).reset_index()
    
    # --- MERGING ---
    
    # Start with Pricing data
    master_df = pricing[['SKU', 'Product_description', 'Current_Price', 'Min_Acceptable_Price', 'Total_Unit_Cost']]
    
    # Merge Inventory
    master_df = master_df.merge(inventory[['SKU', 'days-of-supply', 'available']], on='SKU', how='left')
    
    # Merge Competitors
    master_df = master_df.merge(competitor[['SKU', 'Avg_Competitor_Price', 'Lowest_Competitor_Price']], on='SKU', how='left')
    
    # Merge Ads
    master_df = master_df.merge(ads_agg, on='SKU', how='left')
    
    # Merge Sales & Returns
    master_df = master_df.merge(sales_agg, on='SKU', how='left')
    master_df = master_df.merge(returns_agg, on='SKU', how='left')
    
    # Fill NaNs for calculation logic
    master_df['roasClicks7d'].fillna(0, inplace=True)
    master_df['days-of-supply'].fillna(45, inplace=True) # Assume healthy if missing
    master_df['Avg_Competitor_Price'].fillna(master_df['Current_Price'], inplace=True)
    master_df['Units Ordered'].fillna(0, inplace=True)
    
    # --- PRICING LOGIC ENGINE ---
    
    recommendations = []
    
    for index, row in master_df.iterrows():
        sku = row['SKU']
        current_price = row['Current_Price']
        min_price = row['Min_Acceptable_Price']
        days_supply = row['days-of-supply']
        roas = row['roasClicks7d']
        comp_avg = row['Avg_Competitor_Price']
        units_sold = row['Units Ordered']
        
        # Calculate Return Rate
        returns_qty = row.get('Return Quantity \n(Last 90 days)', 0)
        return_rate = (returns_qty / units_sold) if units_sold > 0 else 0
        
        rec_price = current_price
        action = "HOLD"
        rationale = "Performance within acceptable parameters."
        
        # --- STEP 1: INVENTORY CHECK (Highest Priority) ---
        
        # Critical Stockout: Aggressive Increase
        if days_supply <= 10:
            rec_price = current_price * 1.10
            action = "INCREASE"
            rationale = f"CRITICAL STOCK ({days_supply:.1f} days). Increasing price to extend inventory coverage."
            
        # Overstock: Decrease to Liquidate
        elif days_supply >= 90:
            rec_price = current_price * 0.90
            action = "DECREASE"
            rationale = f"OVERSTOCKED ({days_supply:.1f} days). Discounting to clear inventory and reduce fees."
            
        # --- STEP 2: MARGIN CORRECTION (If Inventory is Healthy) ---
        
        elif current_price < min_price:
            rec_price = min_price * 1.05 # Add 5% buffer above min
            action = "INCREASE"
            rationale = "Current price is below Minimum Acceptable Margin. Correcting pricing."
            
        # --- STEP 3: EFFICIENCY CHECK (If Inventory Healthy & Margin Met) ---
        
        else:
            # High ROAS: Underpriced? Capture Margin.
            if roas >= 4.0:
                rec_price = current_price * 1.05
                action = "INCREASE"
                rationale = "High Advertising Efficiency (ROAS > 4). Testing price elasticity."
                
            # Low ROAS: Overpriced? Boost Conversion.
            elif roas > 0 and roas <= 1.5:
                rec_price = current_price * 0.95
                action = "DECREASE"
                rationale = "Low Conversion/ROAS (< 1.5). Reducing price to stimulate demand."
                
            # High Return Rate: Do not increase
            elif return_rate > 0.15: # > 15% return rate
                rec_price = current_price # Hold
                action = "HOLD"
                rationale = f"High Return Rate ({return_rate:.1%}). Maintaining price to avoid conversion drop."

        # --- STEP 4: COMPETITIVE SANITY CHECK ---
        
        # If recommended price is way above market, cap it.
        if rec_price > (comp_avg * 1.15):
            rec_price = comp_avg * 1.10
            rationale += " (Capped at Competitor Avg + 10% for competitiveness)"

        # --- STEP 5: FINAL FLOOR VALIDATION ---
        
        if rec_price < min_price:
            rec_price = min_price
            rationale += " (Adjusted to meet Minimum Margin Floor)"

        # Round to 2 decimals
        rec_price = round(rec_price, 2)
        
        recommendations.append({
            'SKU': sku,
            'Description': row['Product_description'],
            'Current_Price': current_price,
            'Min_Acceptable_Price': round(min_price, 2),
            'Days_Supply': days_supply,
            'ROAS_7d': roas,
            'Competitor_Avg': comp_avg,
            'Action': action,
            'Recommended_Price': rec_price,
            'Change_%': round(((rec_price - current_price) / current_price) * 100, 1),
            'Rationale': rationale
        })
        
    return pd.DataFrame(recommendations)

# --- MAIN EXECUTION BLOCK ---
if __name__ == "__main__":
    
    # 1. Load Data
    try:
        pricing, inventory, competitor, ads, sales, returns = load_and_clean_data()
        
        # 2. Enrich Pricing Data with Economic Floors
        pricing = calculate_economic_floor(pricing)
        
        # 3. Generate Recommendations
        final_df = generate_recommendations(pricing, inventory, competitor, ads, sales, returns)
        
        # 4. Display Summary
        print("\n--- Pricing Recommendations Summary ---")
        print(final_df[['SKU', 'Current_Price', 'Recommended_Price', 'Action', 'Change_%', 'Rationale']].to_string(index=False))
        
        # 5. Save to CSV
        output_filename = 'Final_Pricing_Recommendations.csv'
        final_df.to_csv(output_filename, index=False)
        print(f"\nFull report saved to: {output_filename}")
        
    except FileNotFoundError as e:
        print(f"\nError: {e}. Please ensure all CSV files are in the directory.")
```
